"use strict";var e,t,n=require("zod"),o=require("axios"),i=require("url"),r=require("crypto"),s=require("js-yaml"),a=function(){return a=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a.apply(this,arguments)};function p(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{p(o.next(e))}catch(e){r(e)}}function a(e){try{p(o.throw(e))}catch(e){r(e)}}function p(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}p((o=o.apply(e,t||[])).next())}))}function l(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(p){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,p])}}}function u(e,t,n){if(n||2===arguments.length)for(var o,i=0,r=t.length;i<r;i++)!o&&i in t||(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return e.concat(o||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var c,d=n.z.string().uuid();exports.EModelEndpoint=void 0,(c=exports.EModelEndpoint||(exports.EModelEndpoint={})).azureOpenAI="azureOpenAI",c.openAI="openAI",c.bingAI="bingAI",c.chatGPTBrowser="chatGPTBrowser",c.google="google",c.gptPlugins="gptPlugins",c.anthropic="anthropic",c.assistants="assistants",c.custom="custom";var m,h=((e={})[exports.EModelEndpoint.google]={model:{default:"chat-bison"},maxOutputTokens:{min:1,max:2048,step:1,default:1024,maxGeminiPro:8192,defaultGeminiPro:8192},temperature:{min:0,max:1,step:.01,default:.2},topP:{min:0,max:1,step:.01,default:.8},topK:{min:1,max:40,step:.01,default:40}},e),f=h[exports.EModelEndpoint.google],g=n.z.nativeEnum(exports.EModelEndpoint),x=n.z.union([g,n.z.string()]);exports.ImageDetail=void 0,(m=exports.ImageDetail||(exports.ImageDetail={})).low="low",m.auto="auto",m.high="high";var v=((t={})[exports.ImageDetail.low]=0,t[exports.ImageDetail.auto]=1,t[exports.ImageDetail.high]=2,t),E={0:exports.ImageDetail.low,1:exports.ImageDetail.auto,2:exports.ImageDetail.high},b=n.z.nativeEnum(exports.ImageDetail),y=n.z.object({authField:n.z.string(),label:n.z.string(),description:n.z.string()}),z=n.z.object({name:n.z.string(),pluginKey:n.z.string(),description:n.z.string(),icon:n.z.string(),authConfig:n.z.array(y),authenticated:n.z.boolean().optional(),isButton:n.z.boolean().optional()}),I=n.z.object({input:n.z.object({content:n.z.string()}),output:n.z.object({content:n.z.string()})}),T=n.z.object({agent:n.z.string(),skipCompletion:n.z.boolean(),model:n.z.string(),temperature:n.z.number()}),S=n.z.object({messageId:n.z.string(),endpoint:n.z.string().optional(),clientId:n.z.string().nullable().optional(),conversationId:n.z.string().nullable(),parentMessageId:n.z.string().nullable(),responseMessageId:n.z.string().nullable().optional(),overrideParentMessageId:n.z.string().nullable().optional(),bg:n.z.string().nullable().optional(),model:n.z.string().nullable().optional(),title:n.z.string().nullable().or(n.z.literal("New Chat")).default("New Chat"),sender:n.z.string(),text:n.z.string(),generation:n.z.string().nullable().optional(),isEdited:n.z.boolean().optional(),isCreatedByUser:n.z.boolean(),error:n.z.boolean(),createdAt:n.z.string().optional().default((function(){return(new Date).toISOString()})),updatedAt:n.z.string().optional().default((function(){return(new Date).toISOString()})),current:n.z.boolean().optional(),unfinished:n.z.boolean().optional(),searchResult:n.z.boolean().optional(),finish_reason:n.z.string().optional(),thread_id:n.z.string().optional()}),M=n.z.object({conversationId:n.z.string().nullable(),title:n.z.string().nullable().or(n.z.literal("New Chat")).default("New Chat"),user:n.z.string().optional(),endpoint:g.nullable(),endpointType:g.optional(),suggestions:n.z.array(n.z.string()).optional(),messages:n.z.array(n.z.string()).optional(),tools:n.z.array(z).optional(),createdAt:n.z.string(),updatedAt:n.z.string(),systemMessage:n.z.string().nullable().optional(),modelLabel:n.z.string().nullable().optional(),examples:n.z.array(I).optional(),chatGptLabel:n.z.string().nullable().optional(),userLabel:n.z.string().optional(),model:n.z.string().nullable().optional(),promptPrefix:n.z.string().nullable().optional(),temperature:n.z.number().optional(),topP:n.z.number().optional(),topK:n.z.number().optional(),context:n.z.string().nullable().optional(),top_p:n.z.number().optional(),frequency_penalty:n.z.number().optional(),presence_penalty:n.z.number().optional(),jailbreak:n.z.boolean().optional(),jailbreakConversationId:n.z.string().nullable().optional(),conversationSignature:n.z.string().nullable().optional(),parentMessageId:n.z.string().optional(),clientId:n.z.string().nullable().optional(),invocationId:n.z.number().nullable().optional(),toneStyle:n.z.string().nullable().optional(),maxOutputTokens:n.z.number().optional(),agentOptions:T.nullable().optional(),file_ids:n.z.array(n.z.string()).optional(),resendImages:n.z.boolean().optional(),imageDetail:b.optional(),assistant_id:n.z.string().optional(),instructions:n.z.string().optional(),presetOverride:n.z.record(n.z.unknown()).optional()}),_=M.omit({conversationId:!0,createdAt:!0,updatedAt:!0,title:!0}).merge(n.z.object({conversationId:n.z.string().nullable().optional(),presetId:n.z.string().nullable().optional(),title:n.z.string().nullable().optional(),defaultPreset:n.z.boolean().optional(),order:n.z.number().optional(),endpoint:x.nullable()})),O=M.merge(n.z.object({endpoint:x.nullable()})),P=M.merge(n.z.object({endpoint:x.nullable()})),C=M.pick({model:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendImages:!0,imageDetail:!0}).transform((function(e){var t,n,o,i,r,s,p,l,u;return a(a({},e),{model:null!==(t=e.model)&&void 0!==t?t:"gpt-3.5-turbo",chatGptLabel:null!==(n=e.chatGptLabel)&&void 0!==n?n:null,promptPrefix:null!==(o=e.promptPrefix)&&void 0!==o?o:null,temperature:null!==(i=e.temperature)&&void 0!==i?i:1,top_p:null!==(r=e.top_p)&&void 0!==r?r:1,presence_penalty:null!==(s=e.presence_penalty)&&void 0!==s?s:0,frequency_penalty:null!==(p=e.frequency_penalty)&&void 0!==p?p:0,resendImages:null!==(l=e.resendImages)&&void 0!==l&&l,imageDetail:null!==(u=e.imageDetail)&&void 0!==u?u:exports.ImageDetail.auto})})).catch((function(){return{model:"gpt-3.5-turbo",chatGptLabel:null,promptPrefix:null,temperature:1,top_p:1,presence_penalty:0,frequency_penalty:0,resendImages:!1,imageDetail:exports.ImageDetail.auto}})),A=M.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0}).transform((function(e){var t,n,o,i,r,s,p,l,u,c,d=null===(n=null===(t=null==e?void 0:e.model)||void 0===t?void 0:t.toLowerCase())||void 0===n?void 0:n.includes("gemini-pro"),m=d?f.maxOutputTokens.maxGeminiPro:f.maxOutputTokens.max,h=d?f.maxOutputTokens.defaultGeminiPro:f.maxOutputTokens.default,g=null!==(o=e.maxOutputTokens)&&void 0!==o?o:h;return g=Math.min(g,m),a(a({},e),{model:null!==(i=e.model)&&void 0!==i?i:f.model.default,modelLabel:null!==(r=e.modelLabel)&&void 0!==r?r:null,promptPrefix:null!==(s=e.promptPrefix)&&void 0!==s?s:null,examples:null!==(p=e.examples)&&void 0!==p?p:[{input:{content:""},output:{content:""}}],temperature:null!==(l=e.temperature)&&void 0!==l?l:f.temperature.default,maxOutputTokens:g,topP:null!==(u=e.topP)&&void 0!==u?u:f.topP.default,topK:null!==(c=e.topK)&&void 0!==c?c:f.topK.default})})).catch((function(){return{model:f.model.default,modelLabel:null,promptPrefix:null,examples:[{input:{content:""},output:{content:""}}],temperature:f.temperature.default,maxOutputTokens:f.maxOutputTokens.default,topP:f.topP.default,topK:f.topK.default}})),L=M.pick({jailbreak:!0,systemMessage:!0,context:!0,toneStyle:!0,jailbreakConversationId:!0,conversationSignature:!0,clientId:!0,invocationId:!0}).transform((function(e){var t,n,o,i,r,s,p,l;return a(a({},e),{model:"",jailbreak:null!==(t=e.jailbreak)&&void 0!==t&&t,systemMessage:null!==(n=e.systemMessage)&&void 0!==n?n:null,context:null!==(o=e.context)&&void 0!==o?o:null,toneStyle:null!==(i=e.toneStyle)&&void 0!==i?i:"creative",jailbreakConversationId:null!==(r=e.jailbreakConversationId)&&void 0!==r?r:null,conversationSignature:null!==(s=e.conversationSignature)&&void 0!==s?s:null,clientId:null!==(p=e.clientId)&&void 0!==p?p:null,invocationId:null!==(l=e.invocationId)&&void 0!==l?l:1})})).catch((function(){return{model:"",jailbreak:!1,systemMessage:null,context:null,toneStyle:"creative",jailbreakConversationId:null,conversationSignature:null,clientId:null,invocationId:1}})),w=M.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0}).transform((function(e){var t,n,o,i,r,s,p;return a(a({},e),{model:null!==(t=e.model)&&void 0!==t?t:"claude-1",modelLabel:null!==(n=e.modelLabel)&&void 0!==n?n:null,promptPrefix:null!==(o=e.promptPrefix)&&void 0!==o?o:null,temperature:null!==(i=e.temperature)&&void 0!==i?i:1,maxOutputTokens:null!==(r=e.maxOutputTokens)&&void 0!==r?r:4e3,topP:null!==(s=e.topP)&&void 0!==s?s:.7,topK:null!==(p=e.topK)&&void 0!==p?p:5})})).catch((function(){return{model:"claude-1",modelLabel:null,promptPrefix:null,temperature:1,maxOutputTokens:4e3,topP:.7,topK:5}})),k=M.pick({model:!0}).transform((function(e){var t;return a(a({},e),{model:null!==(t=e.model)&&void 0!==t?t:"text-davinci-002-render-sha"})})).catch((function(){return{model:"text-davinci-002-render-sha"}})),j=M.pick({model:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,tools:!0,agentOptions:!0}).transform((function(e){var t,n,o,i,r,s,p,l,u;return a(a({},e),{model:null!==(t=e.model)&&void 0!==t?t:"gpt-3.5-turbo",chatGptLabel:null!==(n=e.chatGptLabel)&&void 0!==n?n:null,promptPrefix:null!==(o=e.promptPrefix)&&void 0!==o?o:null,temperature:null!==(i=e.temperature)&&void 0!==i?i:.8,top_p:null!==(r=e.top_p)&&void 0!==r?r:1,presence_penalty:null!==(s=e.presence_penalty)&&void 0!==s?s:0,frequency_penalty:null!==(p=e.frequency_penalty)&&void 0!==p?p:0,tools:null!==(l=e.tools)&&void 0!==l?l:[],agentOptions:null!==(u=e.agentOptions)&&void 0!==u?u:{agent:"functions",skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0}})})).catch((function(){return{model:"gpt-3.5-turbo",chatGptLabel:null,promptPrefix:null,temperature:.8,top_p:1,presence_penalty:0,frequency_penalty:0,tools:[],agentOptions:{agent:"functions",skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0}}}));function G(e){var t=a({},e);return Object.keys(t).forEach((function(e){void 0!==t[e]&&null!==t[e]&&""!==t[e]||delete t[e]})),t}var D,N,R,F,K,q,B,U,H,V=M.pick({model:!0,assistant_id:!0,instructions:!0,promptPrefix:!0}).transform(G).catch((function(){return{}})),$=M.pick({model:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendImages:!0,imageDetail:!0}).transform((function(e){var t=a({},e);return"gpt-3.5-turbo"===t.model&&delete t.model,1===t.temperature&&delete t.temperature,1===t.top_p&&delete t.top_p,0===t.presence_penalty&&delete t.presence_penalty,0===t.frequency_penalty&&delete t.frequency_penalty,!0!==t.resendImages&&delete t.resendImages,t.imageDetail===exports.ImageDetail.auto&&delete t.imageDetail,G(t)})).catch((function(){return{}})),Q=M.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0}).transform((function(e){var t=a({},e);return t.model===f.model.default&&delete t.model,t.temperature===f.temperature.default&&delete t.temperature,t.maxOutputTokens===f.maxOutputTokens.default&&delete t.maxOutputTokens,t.topP===f.topP.default&&delete t.topP,t.topK===f.topK.default&&delete t.topK,G(t)})).catch((function(){return{}})),W=M.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0}).transform((function(e){var t=a({},e);return"claude-1"===t.model&&delete t.model,1===t.temperature&&delete t.temperature,4e3===t.maxOutputTokens&&delete t.maxOutputTokens,.7===t.topP&&delete t.topP,5===t.topK&&delete t.topK,G(t)})).catch((function(){return{}})),X=M.pick({model:!0}).transform((function(e){var t=a({},e);return"text-davinci-002-render-sha"===t.model&&delete t.model,G(t)})).catch((function(){return{}})),J=M.pick({model:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,tools:!0,agentOptions:!0}).transform((function(e){var t,n=a({},e);return"gpt-3.5-turbo"===n.model&&delete n.model,null===n.chatGptLabel&&delete n.chatGptLabel,null===n.promptPrefix&&delete n.promptPrefix,.8===n.temperature&&delete n.temperature,1===n.top_p&&delete n.top_p,0===n.presence_penalty&&delete n.presence_penalty,0===n.frequency_penalty&&delete n.frequency_penalty,0===(null===(t=n.tools)||void 0===t?void 0:t.length)&&delete n.tools,n.agentOptions&&"functions"===n.agentOptions.agent&&!0===n.agentOptions.skipCompletion&&"gpt-3.5-turbo"===n.agentOptions.model&&0===n.agentOptions.temperature&&delete n.agentOptions,G(n)})).catch((function(){return{}})),Y=((D={})[exports.EModelEndpoint.openAI]=!0,D[exports.EModelEndpoint.google]=!0,D[exports.EModelEndpoint.assistants]=!0,D[exports.EModelEndpoint.azureOpenAI]=!0,D[exports.EModelEndpoint.custom]=!0,D),Z=["application/vnd.ms-excel","application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],ee=u(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","image/jpeg","text/javascript","image/gif","image/png","application/x-tar","application/typescript","application/xml","application/zip"],Z,!0),te=u(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","image/jpeg","text/javascript","image/gif","image/png","application/x-tar","application/typescript","application/xml","application/zip"],Z,!0),ne=/^application\/(vnd\.ms-excel|msexcel|x-msexcel|x-ms-excel|x-excel|x-dos_ms_excel|xls|x-xls|vnd\.openxmlformats-officedocument\.spreadsheetml\.sheet)$/,oe=/^(text\/(x-c|x-c\+\+|x-java|html|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|css|javascript|csv))$/,ie=/^(application\/(csv|json|pdf|x-tar|typescript|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)|xml|zip))$/,re=/^image\/(jpeg|gif|png|webp)$/,se=[oe,ne,ie,re],ae=[oe,ne,ie,re],pe=1048576,le=function(e){return e*pe},ue={endpoints:(N={},N[exports.EModelEndpoint.assistants]={fileLimit:10,fileSizeLimit:le(512),totalSizeLimit:le(512),supportedMimeTypes:se,disabled:!1},N.default={fileLimit:10,fileSizeLimit:le(20),totalSizeLimit:le(25),supportedMimeTypes:[re],disabled:!1},N),serverFileSizeLimit:le(512),avatarSizeLimit:le(2),checkType:function(e,t){return void 0===t&&(t=se),t.some((function(t){return t.test(e)}))}},ce=n.z.array(n.z.any()).optional().refine((function(e){return!e||e.every((function(e){return e instanceof RegExp||"string"==typeof e}))}),{message:"Each mimeType must be a string or a RegExp object."}),de=n.z.object({disabled:n.z.boolean().optional(),fileLimit:n.z.number().min(0).optional(),fileSizeLimit:n.z.number().min(0).optional(),totalSizeLimit:n.z.number().min(0).optional(),supportedMimeTypes:ce.optional()}),me=n.z.object({endpoints:n.z.record(de).optional(),serverFileSizeLimit:n.z.number().min(0).optional(),avatarSizeLimit:n.z.number().min(0).optional()}),he=function(e){return e.reduce((function(e,t){try{var n=new RegExp(t);e.push(n)}catch(e){console.error('Invalid regex pattern "'.concat(t,'" skipped.'))}return e}),[])};exports.FileSources=void 0,(R=exports.FileSources||(exports.FileSources={})).local="local",R.firebase="firebase",R.openai="openai",R.s3="s3",exports.FileContext=void 0,(F=exports.FileContext||(exports.FileContext={})).avatar="avatar",F.unknown="unknown",F.assistants="assistants",F.image_generation="image_generation",F.assistants_output="assistants_output",F.message_attachment="message_attachment";var fe,ge=n.z.nativeEnum(exports.FileSources),xe=n.z.object({disableBuilder:n.z.boolean().optional(),pollIntervalMs:n.z.number().optional(),timeoutMs:n.z.number().optional(),supportedIds:n.z.array(n.z.string()).min(1).optional(),excludedIds:n.z.array(n.z.string()).min(1).optional(),apiKey:n.z.string().optional(),baseURL:n.z.string().optional(),models:n.z.object({default:n.z.array(n.z.string()).min(1),fetch:n.z.boolean().optional(),userIdQuery:n.z.boolean().optional()}).optional(),titleConvo:n.z.boolean().optional(),titleMethod:n.z.union([n.z.literal("completion"),n.z.literal("functions")]).optional(),titleModel:n.z.string().optional(),headers:n.z.record(n.z.any()).optional()}),ve=n.z.object({name:n.z.string().refine((function(e){return!g.safeParse(e).success}),{message:"Value cannot be one of the default endpoint (EModelEndpoint) values: ".concat(Object.values(exports.EModelEndpoint).join(", "))}),apiKey:n.z.string(),baseURL:n.z.string(),models:n.z.object({default:n.z.array(n.z.string()).min(1),fetch:n.z.boolean().optional(),userIdQuery:n.z.boolean().optional()}),titleConvo:n.z.boolean().optional(),titleMethod:n.z.union([n.z.literal("completion"),n.z.literal("functions")]).optional(),titleModel:n.z.string().optional(),summarize:n.z.boolean().optional(),summaryModel:n.z.string().optional(),forcePrompt:n.z.boolean().optional(),modelDisplayLabel:n.z.string().optional(),headers:n.z.record(n.z.any()).optional(),addParams:n.z.record(n.z.any()).optional(),dropParams:n.z.array(n.z.string()).optional()}),Ee=n.z.object({fileUploads:n.z.object({ipMax:n.z.number().optional(),ipWindowInMinutes:n.z.number().optional(),userMax:n.z.number().optional(),userWindowInMinutes:n.z.number().optional()}).optional()}),be=n.z.object({version:n.z.string(),cache:n.z.boolean(),fileStrategy:ge.optional(),registration:n.z.object({socialLogins:n.z.array(n.z.string()).optional(),allowedDomains:n.z.array(n.z.string()).optional()}).optional(),rateLimits:Ee.optional(),fileConfig:me.optional(),endpoints:n.z.object((K={},K[exports.EModelEndpoint.assistants]=xe.optional(),K.custom=n.z.array(ve.partial()).optional(),K)).strict().refine((function(e){return Object.keys(e).length>0}),{message:"At least one `endpoints` field must be provided."}).optional()});exports.KnownEndpoints=void 0,(fe=exports.KnownEndpoints||(exports.KnownEndpoints={})).mistral="mistral",fe.openrouter="openrouter";var ye=[exports.EModelEndpoint.openAI,exports.EModelEndpoint.assistants,exports.EModelEndpoint.azureOpenAI,exports.EModelEndpoint.bingAI,exports.EModelEndpoint.chatGPTBrowser,exports.EModelEndpoint.gptPlugins,exports.EModelEndpoint.google,exports.EModelEndpoint.anthropic,exports.EModelEndpoint.custom],ze=((q={})[exports.EModelEndpoint.openAI]="OpenAI",q[exports.EModelEndpoint.assistants]="Assistants",q[exports.EModelEndpoint.azureOpenAI]="Azure OpenAI",q[exports.EModelEndpoint.bingAI]="IntelliumGPT",q[exports.EModelEndpoint.chatGPTBrowser]="ChatGPT",q[exports.EModelEndpoint.gptPlugins]="Plugins",q[exports.EModelEndpoint.google]="Google",q[exports.EModelEndpoint.anthropic]="Anthropic",q[exports.EModelEndpoint.custom]="Custom",q),Ie=((B={})[exports.EModelEndpoint.assistants]=["gpt-3.5-turbo-0125","gpt-4-0125-preview","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-3.5-turbo","gpt-4","gpt-4-0314","gpt-4-32k-0314","gpt-4-0613","gpt-3.5-turbo-0613"],B[exports.EModelEndpoint.google]=["gemini-pro","gemini-pro-vision","chat-bison","chat-bison-32k","codechat-bison","codechat-bison-32k","text-bison","text-bison-32k","text-unicorn","code-gecko","code-bison","code-bison-32k"],B[exports.EModelEndpoint.anthropic]=["claude-2.1","claude-2","claude-1.2","claude-1","claude-1-100k","claude-instant-1","claude-instant-1-100k"],B[exports.EModelEndpoint.openAI]=["gpt-3.5-turbo-0125","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-4-turbo-preview","gpt-4-0125-preview","gpt-4-1106-preview","gpt-3.5-turbo","gpt-3.5-turbo-1106","gpt-4-vision-preview","gpt-4","gpt-3.5-turbo-instruct-0914","gpt-3.5-turbo-0613","gpt-3.5-turbo-0301","gpt-3.5-turbo-instruct","gpt-4-0613","text-davinci-003","gpt-4-0314"],B),Te=new Set(["gpt-3.5-turbo-0125","gpt-4-0125-preview","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106"]),Se=((U={})[exports.EModelEndpoint.openAI]="/api/ask/".concat(exports.EModelEndpoint.openAI),U[exports.EModelEndpoint.bingAI]="/api/ask/".concat(exports.EModelEndpoint.bingAI),U[exports.EModelEndpoint.google]="/api/ask/".concat(exports.EModelEndpoint.google),U[exports.EModelEndpoint.custom]="/api/ask/".concat(exports.EModelEndpoint.custom),U[exports.EModelEndpoint.anthropic]="/api/ask/".concat(exports.EModelEndpoint.anthropic),U[exports.EModelEndpoint.gptPlugins]="/api/ask/".concat(exports.EModelEndpoint.gptPlugins),U[exports.EModelEndpoint.azureOpenAI]="/api/ask/".concat(exports.EModelEndpoint.azureOpenAI),U[exports.EModelEndpoint.chatGPTBrowser]="/api/ask/".concat(exports.EModelEndpoint.chatGPTBrowser),U[exports.EModelEndpoint.assistants]="/api/assistants/chat",U),Me=new Set([exports.EModelEndpoint.gptPlugins,exports.EModelEndpoint.anthropic,exports.EModelEndpoint.google,exports.EModelEndpoint.openAI,exports.EModelEndpoint.azureOpenAI,exports.EModelEndpoint.custom]),_e=((H={})[exports.EModelEndpoint.openAI]=!0,H[exports.EModelEndpoint.azureOpenAI]=!0,H[exports.EModelEndpoint.gptPlugins]=!0,H[exports.EModelEndpoint.custom]=!0,H),Oe=["gpt-4-vision","llava-13b","gemini-pro-vision"];var Pe,Ce,Ae,Le,we,ke=new Set(["dalle","dall-e","stable-diffusion"]);exports.CacheKeys=void 0,(Pe=exports.CacheKeys||(exports.CacheKeys={})).CONFIG_STORE="configStore",Pe.PLUGINS="plugins",Pe.GEN_TITLE="genTitle",Pe.TOOLS="tools",Pe.MODELS_CONFIG="modelsConfig",Pe.MODEL_QUERIES="modelQueries",Pe.ENDPOINT_CONFIG="endpointsConfig",Pe.TOKEN_CONFIG="tokenConfig",Pe.CUSTOM_CONFIG="customConfig",Pe.ABORT_KEYS="abortKeys",Pe.OVERRIDE_CONFIG="overrideConfig",Pe.FILE_UPLOAD_LIMIT="file_upload_limit",exports.AuthKeys=void 0,(Ce=exports.AuthKeys||(exports.AuthKeys={})).GOOGLE_SERVICE_KEY="GOOGLE_SERVICE_KEY",Ce.GOOGLE_API_KEY="GOOGLE_API_KEY",exports.ImageDetailCost=void 0,(Ae=exports.ImageDetailCost||(exports.ImageDetailCost={}))[Ae.LOW=85]="LOW",Ae[Ae.HIGH=170]="HIGH",Ae[Ae.ADDITIONAL=85]="ADDITIONAL",exports.SettingsTabValues=void 0,(Le=exports.SettingsTabValues||(exports.SettingsTabValues={})).GENERAL="general",Le.BETA="beta",Le.DATA="data",Le.ACCOUNT="account",exports.Constants=void 0,(we=exports.Constants||(exports.Constants={})).VERSION="v0.6.10",we.CONFIG_VERSION="1.0.3",we.NO_PARENT="00000000-0000-0000-0000-000000000000";var je,Ge,De=((je={})[exports.EModelEndpoint.openAI]=C,je[exports.EModelEndpoint.azureOpenAI]=C,je[exports.EModelEndpoint.custom]=C,je[exports.EModelEndpoint.google]=A,je[exports.EModelEndpoint.bingAI]=L,je[exports.EModelEndpoint.anthropic]=w,je[exports.EModelEndpoint.chatGPTBrowser]=k,je[exports.EModelEndpoint.gptPlugins]=j,je[exports.EModelEndpoint.assistants]=V,je);function Ne(e){for(var t,n=0,o=e;n<o.length;n++){var i=o[n];if(i){t=i;break}}return t}var Re,Fe,Ke,qe,Be,Ue,He,Ve=((Ge={})[exports.EModelEndpoint.openAI]=$,Ge[exports.EModelEndpoint.azureOpenAI]=$,Ge[exports.EModelEndpoint.custom]=$,Ge[exports.EModelEndpoint.assistants]=V,Ge[exports.EModelEndpoint.google]=Q,Ge[exports.EModelEndpoint.bingAI]=L,Ge[exports.EModelEndpoint.anthropic]=W,Ge[exports.EModelEndpoint.chatGPTBrowser]=X,Ge[exports.EModelEndpoint.gptPlugins]=J,Ge);exports.Tools=void 0,(Re=exports.Tools||(exports.Tools={})).code_interpreter="code_interpreter",Re.retrieval="retrieval",Re.function="function",exports.ContentTypes=void 0,(Fe=exports.ContentTypes||(exports.ContentTypes={})).TEXT="text",Fe.TOOL_CALL="tool_call",Fe.IMAGE_FILE="image_file",exports.StepTypes=void 0,(Ke=exports.StepTypes||(exports.StepTypes={})).TOOL_CALLS="tool_calls",Ke.MESSAGE_CREATION="message_creation",exports.ToolCallTypes=void 0,(qe=exports.ToolCallTypes||(exports.ToolCallTypes={})).FUNCTION="function",qe.RETRIEVAL="retrieval",qe.CODE_INTERPRETER="code_interpreter",exports.StepStatus=void 0,(Be=exports.StepStatus||(exports.StepStatus={})).IN_PROGRESS="in_progress",Be.CANCELLED="cancelled",Be.FAILED="failed",Be.COMPLETED="completed",Be.EXPIRED="expired",exports.MessageContentTypes=void 0,(Ue=exports.MessageContentTypes||(exports.MessageContentTypes={})).TEXT="text",Ue.IMAGE_FILE="image_file",exports.RunStatus=void 0,(He=exports.RunStatus||(exports.RunStatus={})).QUEUED="queued",He.IN_PROGRESS="in_progress",He.REQUIRES_ACTION="requires_action",He.CANCELLING="cancelling",He.CANCELLED="cancelled",He.FAILED="failed",He.COMPLETED="completed",He.EXPIRED="expired";var $e,Qe,We,Xe,Je,Ye;function Ze(e){o.defaults.headers.common.Authorization="Bearer "+e}exports.AuthTypeEnum=void 0,($e=exports.AuthTypeEnum||(exports.AuthTypeEnum={})).ServiceHttp="service_http",$e.OAuth="oauth",$e.None="none",exports.AuthorizationTypeEnum=void 0,(Qe=exports.AuthorizationTypeEnum||(exports.AuthorizationTypeEnum={})).Bearer="bearer",Qe.Basic="basic",Qe.Custom="custom",exports.TokenExchangeMethodEnum=void 0,(We=exports.TokenExchangeMethodEnum||(exports.TokenExchangeMethodEnum={})).DefaultPost="default_post",We.BasicAuthHeader="basic_auth_header",exports.FilePurpose=void 0,(Xe=exports.FilePurpose||(exports.FilePurpose={})).FineTune="fine-tune",Xe.FineTuneResults="fine-tune-results",Xe.Assistants="assistants",Xe.AssistantsOutput="assistants_output",exports.QueryKeys=void 0,(Je=exports.QueryKeys||(exports.QueryKeys={})).messages="messages",Je.allConversations="allConversations",Je.searchConversations="searchConversations",Je.conversation="conversation",Je.searchEnabled="searchEnabled",Je.user="user",Je.name="name",Je.models="models",Je.balance="balance",Je.endpoints="endpoints",Je.presets="presets",Je.searchResults="searchResults",Je.tokenCount="tokenCount",Je.availablePlugins="availablePlugins",Je.startupConfig="startupConfig",Je.assistants="assistants",Je.assistant="assistant",Je.endpointsConfigOverride="endpointsConfigOverride",Je.files="files",Je.fileConfig="fileConfig",Je.tools="tools",Je.actions="actions",Je.assistantDocs="assistantDocs",exports.MutationKeys=void 0,(Ye=exports.MutationKeys||(exports.MutationKeys={})).fileUpload="fileUpload",Ye.fileDelete="fileDelete",Ye.updatePreset="updatePreset",Ye.deletePreset="deletePreset",Ye.logoutUser="logoutUser",Ye.avatarUpload="avatarUpload",Ye.assistantAvatarUpload="assistantAvatarUpload",Ye.updateAction="updateAction",Ye.deleteAction="deleteAction";var et=function(e,t){return"/api/messages/".concat(e).concat(t?"/".concat(t):"")},tt="/api/keys",nt=function(e){return"/api/convos?pageNumber=".concat(e)},ot=function(e,t){return"/api/search?q=".concat(e,"&pageNumber=").concat(t)},it=function(e){return"/api/assistants".concat(e?"/".concat(e):"")},rt=function(){return"".concat("/api/files","/images")};function st(e,t){return p(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,o.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))}var at=!1,pt=[],lt=function(e){return st(function(e){return"/api/auth/refresh".concat(e?"?retry=true":"")}(e))},ut=function(e,t){void 0===t&&(t=null),pt.forEach((function(n){e?n.reject(e):n.resolve(t)})),pt=[]};o.interceptors.response.use((function(e){return e}),(function(e){return p(void 0,void 0,void 0,(function(){var t,n,i,r,s;return l(this,(function(a){switch(a.label){case 0:if(t=e.config,401!==e.response.status||t._retry)return[3,13];if(t._retry=!0,!at)return[3,5];a.label=1;case 1:return a.trys.push([1,4,,5]),[4,new Promise((function(e,t){pt.push({resolve:e,reject:t})}))];case 2:return i=a.sent(),t.headers.Authorization="Bearer "+i,[4,o(t)];case 3:return[2,a.sent()];case 4:return n=a.sent(),[2,Promise.reject(n)];case 5:at=!0,a.label=6;case 6:return a.trys.push([6,11,12,13]),[4,lt(!!(null===(s=t.url)||void 0===s?void 0:s.includes("api/auth/refresh")))];case 7:return(i=a.sent().token)?(t.headers.Authorization="Bearer "+i,Ze(i),window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:i})),ut(null,i),[4,o(t)]):[3,9];case 8:return[2,a.sent()];case 9:window.location.href="/login",a.label=10;case 10:return[3,13];case 11:return r=a.sent(),ut(r,null),[2,Promise.reject(r)];case 12:return at=!1,[7];case 13:return[2,Promise.reject(e)]}}))}))}));var ct={get:function(e,t){return p(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,o.get(e,a({},t))];case 1:return[2,n.sent().data]}}))}))},post:st,postMultiPart:function(e,t,n){return p(this,void 0,void 0,(function(){return l(this,(function(i){switch(i.label){case 0:return[4,o.post(e,t,a(a({},n),{headers:{"Content-Type":"multipart/form-data"}}))];case 1:return[2,i.sent().data]}}))}))},put:function(e,t){return p(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,o.put(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},delete:function(e){return p(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return[4,o.delete(e)];case 1:return[2,t.sent().data]}}))}))},deleteWithOptions:function(e,t){return p(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,o.delete(e,a({},t))];case 1:return[2,n.sent().data]}}))}))},patch:function(e,t){return p(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,o.patch(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},refreshToken:lt};var dt=Object.freeze({__proto__:null,abortRequestWithMessage:function(e,t,n){return ct.post(function(e){return"/api/ask/".concat(e,"/abort")}(e),{arg:{abortKey:t,message:n}})},clearAllConversations:function(){return ct.post("/api/convos/clear",{arg:{}})},createAssistant:function(e){return ct.post(it(),e)},createPreset:function(e){return ct.post("/api/presets",e)},deleteAction:function(e,t){return p(void 0,void 0,void 0,(function(){return l(this,(function(n){return[2,ct.delete(it("actions/".concat(e,"/").concat(t)))]}))}))},deleteAssistant:function(e){return ct.delete(it(e))},deleteConversation:function(e){return ct.post("/api/convos/clear",{arg:e})},deleteFiles:function(e,t){return p(void 0,void 0,void 0,(function(){return l(this,(function(n){return[2,ct.deleteWithOptions("/api/files",{data:{files:e,assistant_id:t}})]}))}))},deletePreset:function(e){return ct.post("/api/presets/delete",e)},genTitle:function(e){return ct.post("/api/convos/gen_title",e)},getAIEndpoints:function(){return ct.get("/api/endpoints")},getActions:function(){return ct.get(it("actions"))},getAssistantById:function(e){return ct.get(it(e))},getAssistantDocs:function(){return ct.get(it("documents"))},getAvailablePlugins:function(){return ct.get("/api/plugins")},getAvailableTools:function(){return ct.get("".concat(it(),"/tools"))},getConversationById:function(e){return ct.get(function(e){return"/api/convos/".concat(e)}(e))},getConversations:function(e){return ct.get(nt(e))},getEndpointsConfigOverride:function(){return ct.get("/api/endpoints/config/override")},getFileConfig:function(){return ct.get("".concat("/api/files","/config"))},getFiles:function(){return ct.get("/api/files")},getLoginGoogle:function(){return ct.get("/api/auth/google")},getMessagesByConvoId:function(e){return"new"===e?Promise.resolve([]):ct.get(et(e))},getModels:function(){return p(void 0,void 0,void 0,(function(){return l(this,(function(e){return[2,ct.get("/api/models")]}))}))},getPresets:function(){return ct.get("/api/presets")},getSearchEnabled:function(){return ct.get("/api/search/enable")},getStartupConfig:function(){return ct.get("/api/config")},getUser:function(){return ct.get("/api/user")},getUserBalance:function(){return ct.get("/api/balance")},listAssistants:function(e){return ct.get(it(),{params:e})},listConversations:function(e){var t=(null==e?void 0:e.pageNumber)||"1";return ct.get(nt(t))},listConversationsByQuery:function(e){var t=(null==e?void 0:e.pageNumber)||"1",n=(null==e?void 0:e.searchQuery)||"";return""!==n?ct.get(ot(n,t)):ct.get(nt(t))},login:function(e){return ct.post("/api/auth/login",e)},logout:function(){return ct.post("/api/auth/logout")},register:function(e){return ct.post("/api/auth/register",e)},requestPasswordReset:function(e){return ct.post("/api/auth/requestPasswordReset",e)},resetPassword:function(e){return ct.post("/api/auth/resetPassword",e)},revokeAllUserKeys:function(){return ct.delete("".concat(tt,"?all=true"))},revokeUserKey:function(e){return ct.delete(function(e){return"".concat(tt,"/").concat(e)}(e))},searchConversations:function(e,t){return p(void 0,void 0,void 0,(function(){return l(this,(function(n){return[2,ct.get(ot(e,t))]}))}))},updateAction:function(e){var t=e.assistant_id,n=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(e,["assistant_id"]);return ct.post(it("actions/".concat(t)),n)},updateAssistant:function(e,t){return ct.patch(it(e),t)},updateConversation:function(e){return ct.post("/api/convos/update",{arg:e})},updateMessage:function(e){var t=e.conversationId,n=e.messageId,o=e.text;if(!t)throw new Error("conversationId is required");return ct.put(et(t,n),{text:o})},updatePreset:function(e){return ct.post("/api/presets",e)},updateTokenCount:function(e){return ct.post("/api/tokenizer",{arg:e})},updateUserKey:function(e){if(!e.value)throw new Error("value is required");return ct.put(tt,e)},updateUserPlugins:function(e){return ct.post("/api/user/plugins",e)},uploadAssistantAvatar:function(e){return ct.postMultiPart(it("avatar/".concat(e.assistant_id)),e.formData)},uploadAvatar:function(e){return ct.postMultiPart("".concat(rt(),"/avatar"),e)},uploadFile:function(e){return ct.postMultiPart("/api/files",e)},uploadImage:function(e){return ct.postMultiPart(rt(),e)},userKeyQuery:function(e){return ct.get(function(e){return"".concat(tt,"?name=").concat(e)}(e))}}),mt=function(e,t){if(!(this instanceof mt))return new mt(e,t);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=e,t=t||{},this.headers=t.headers||{},this.payload=void 0!==t.payload?t.payload:"",this.method=t.method||this.payload&&"POST"||"GET",this.withCredentials=!!t.withCredentials,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.addEventListener=function(e,t){void 0===this.listeners[e]&&(this.listeners[e]=[]),-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)},this.removeEventListener=function(e,t){if(void 0!==this.listeners[e]){var n=[];this.listeners[e].forEach((function(e){e!==t&&n.push(e)})),0===n.length?delete this.listeners[e]:this.listeners[e]=n}},this.dispatchEvent=function(e){if(!e)return!0;e.source=this;var t="on"+e.type;return(!this.hasOwnProperty(t)||(this[t].call(this,e),!e.defaultPrevented))&&(!this.listeners[e.type]||this.listeners[e.type].every((function(t){return t(e),!e.defaultPrevented})))},this._setReadyState=function(e){var t=new CustomEvent("readystatechange");t.readyState=e,this.readyState=e,this.dispatchEvent(t)},this._onStreamFailure=function(e){var t=new CustomEvent("error");t.data=e.currentTarget.response,this.dispatchEvent(t),this.close()},this._onStreamAbort=function(e){this.dispatchEvent(new CustomEvent("abort")),this.close()},this._onStreamProgress=async function(e){if(this.xhr){if(401!==this.xhr.status||this._retry){if(200!==this.xhr.status)return void this._onStreamFailure(e)}else{this._retry=!0;try{const e=await ct.refreshToken();this.headers={"Content-Type":"application/json",Authorization:`Bearer ${e.token}`},Ze(e.token),window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:e.token})),this.stream()}catch(t){return void this._onStreamFailure(e)}}this.readyState==this.CONNECTING&&(this.dispatchEvent(new CustomEvent("open")),this._setReadyState(this.OPEN));var t=this.xhr.responseText.substring(this.progress);this.progress+=t.length,t.split(/(\r\n|\r|\n){2}/g).forEach(function(e){0===e.trim().length?(this.dispatchEvent(this._parseEventChunk(this.chunk.trim())),this.chunk=""):this.chunk+=e}.bind(this))}},this._onStreamLoaded=function(e){this._onStreamProgress(e),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""},this._parseEventChunk=function(e){if(!e||0===e.length)return null;var t={id:null,retry:null,data:"",event:"message"};e.split(/\n|\r\n|\r/).forEach(function(e){var n=(e=e.trimRight()).indexOf(this.FIELD_SEPARATOR);if(!(n<=0)){var o=e.substring(0,n);if(o in t){var i=e.substring(n+1).trimLeft();"data"===o?t[o]+=i:t[o]=i}}}.bind(this));var n=new CustomEvent(t.event);return n.data=t.data,n.id=t.id,n},this._checkStreamClosed=function(){this.xhr&&this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)},this.stream=function(){for(var e in this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._checkStreamClosed.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url),this.headers)this.xhr.setRequestHeader(e,this.headers[e]);this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)},this.close=function(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))}};function ht(e){return r.createHash("sha1").update(e).digest("hex")}function ft(e,t){return new i.URL(t,e).toString()}var gt=function(){function e(e,t,n){var o,i;this.name=e,this.description=t,(null===(o=n.properties)||void 0===o?void 0:o.requestBody)?this.parameters=null===(i=n.properties)||void 0===i?void 0:i.requestBody:this.parameters=n}return e.prototype.toObjectTool=function(){return{type:exports.Tools.function,function:{name:this.name,description:this.description,parameters:this.parameters}}},e}(),xt=function(){function e(e,t,n,o,i,r){this.authHeaders={},this.domain=e,this.path=t,this.method=n,this.operation=o,this.isConsequential=i,this.contentType=r}return e.prototype.setParams=function(e){return p(this,void 0,void 0,(function(){return l(this,(function(t){return this.operationHash=ht(JSON.stringify(e)),this.params=e,[2]}))}))},e.prototype.setAuth=function(e){return p(this,void 0,void 0,(function(){var t,n,i,r,s,a,p,u,c,d,m,h,f,g,x;return l(this,(function(l){switch(l.label){case 0:return e.auth?(t=e.auth,n=t.type,i=t.authorization_type,r=t.custom_auth_header,s=t.authorization_url,a=t.client_url,p=t.scope,u=t.token_exchange_method,c=e.api_key,d=e.oauth_client_id,m=e.oauth_client_secret,h=c&&n===exports.AuthTypeEnum.ServiceHttp,f=d&&m&&n===exports.AuthTypeEnum.OAuth&&s&&a&&p&&u,h&&i===exports.AuthorizationTypeEnum.Basic?(g=Buffer.from(c).toString("base64"),this.authHeaders.Authorization="Basic ".concat(g),[3,6]):[3,1]):[2];case 1:return h&&i===exports.AuthorizationTypeEnum.Bearer?(this.authHeaders.Authorization="Bearer ".concat(c),[3,6]):[3,2];case 2:return h&&i===exports.AuthorizationTypeEnum.Custom&&r?(this.authHeaders[r]=c,[3,6]):[3,3];case 3:return f?this.authToken?[3,5]:[4,o.post(a,{client_id:d,client_secret:m,scope:p,grant_type:"client_credentials"},{headers:{"Content-Type":"application/x-www-form-urlencoded"}})]:[3,6];case 4:x=l.sent(),this.authToken=x.data.access_token,l.label=5;case 5:this.authHeaders.Authorization="Bearer ".concat(this.authToken),l.label=6;case 6:return[2]}}))}))},e.prototype.execute=function(){return p(this,void 0,void 0,(function(){var e,t,n;return l(this,(function(i){if(e=ft(this.domain,this.path),t=a(a({},this.authHeaders),{"Content-Type":this.contentType}),"get"===(n=this.method.toLowerCase()))return[2,o.get(e,{headers:t,params:this.params})];if("post"===n)return[2,o.post(e,this.params,{headers:t})];if("put"===n)return[2,o.put(e,this.params,{headers:t})];if("delete"===n)return[2,o.delete(e,{headers:t,data:this.params})];if("patch"===n)return[2,o.patch(e,this.params,{headers:t})];throw new Error("Unsupported HTTP method: ".concat(this.method))}))}))},e}();function vt(e,t){var n;if("$ref"in e&&t){var o=e.$ref.replace(/^#\/components\/schemas\//,""),i=null===(n=t.schemas)||void 0===n?void 0:n[o];if(!i)throw new Error("Reference ".concat(e.$ref," not found"));return vt(i,t)}return e}exports.ActionRequest=xt,exports.EndpointURLs=Se,exports.FunctionSignature=gt,exports.SSE=mt,exports.actionDelimiter="_action_",exports.alternateName=ze,exports.anthropicSchema=w,exports.applicationMimeTypes=ie,exports.assistantEndpointSchema=xe,exports.assistantSchema=V,exports.bingAISchema=L,exports.chatGPTBrowserSchema=k,exports.codeInterpreterMimeTypes=ae,exports.codeInterpreterMimeTypesList=te,exports.compactAnthropicSchema=W,exports.compactChatGPTSchema=X,exports.compactGoogleSchema=Q,exports.compactOpenAISchema=$,exports.compactPluginsSchema=J,exports.configSchema=be,exports.convertStringsToRegex=he,exports.createPayload=function(e){var t=e.conversation,n=e.message;e.messages;var o=e.endpointOption,i=e.isEdited,r=e.isContinued,s=O.parse(t).conversationId,p=o,l=p.endpoint,u=p.endpointType,c=Se[null!=u?u:l];return i&&l===exports.EModelEndpoint.assistants?c+="/modify":i&&(c=c.replace("/ask/","/edit/")),{server:c,payload:a(a(a({},n),o),{isContinued:!(!i||!r),conversationId:s})}},exports.createURL=ft,exports.dataService=dt,exports.defaultAssistantFormValues={assistant:"",id:"",name:"",description:"",instructions:"",model:"gpt-3.5-turbo-1106",functions:[],code_interpreter:!1,retrieval:!1},exports.defaultEndpoints=ye,exports.defaultModels=Ie,exports.defaultOrderQuery={order:"asc"},exports.defaultSocialLogins=["google","facebook","openid","github","discord"],exports.eImageDetailSchema=b,exports.eModelEndpointSchema=g,exports.endpointFileConfigSchema=de,exports.endpointSchema=ve,exports.endpointSettings=h,exports.excelFileTypes=Z,exports.excelMimeTypes=ne,exports.extendedModelEndpointSchema=x,exports.fileConfig=ue,exports.fileConfigSchema=me,exports.fileSourceSchema=ge,exports.fullMimeTypesList=ee,exports.getFirstDefinedValue=Ne,exports.getResponseSender=function(e){var t,n=e.model,o=e.endpoint,i=e.endpointType,r=e.modelDisplayLabel,s=e.chatGptLabel,a=e.modelLabel,p=e.jailbreak;return[exports.EModelEndpoint.openAI,exports.EModelEndpoint.azureOpenAI,exports.EModelEndpoint.gptPlugins,exports.EModelEndpoint.chatGPTBrowser].includes(o)?s||(n&&n.includes("gpt-3")?"GPT-3.5":n&&n.includes("gpt-4")?"GPT-4":n&&n.includes("mistral")?"Mistral":null!==(t=ze[o])&&void 0!==t?t:"ChatGPT"):o===exports.EModelEndpoint.bingAI?p?"IntGPT":"IntGPT Pro":o===exports.EModelEndpoint.anthropic?null!=a?a:"Claude":o===exports.EModelEndpoint.google?a||(n&&n.includes("gemini")?"Gemini":n&&n.includes("code")?"Codey":"PaLM2"):o===exports.EModelEndpoint.custom||i===exports.EModelEndpoint.custom?a||(s||(n&&n.includes("mistral")?"Mistral":n&&n.includes("gpt-3")?"GPT-3.5":n&&n.includes("gpt-4")?"GPT-4":r||"AI")):""},exports.googleSchema=A,exports.gptPluginsSchema=j,exports.imageDetailNumeric=v,exports.imageDetailValue=E,exports.imageExtRegex=/\.(jpg|jpeg|png|gif|webp)$/i,exports.imageGenTools=ke,exports.imageMimeTypes=re,exports.isUUID=d,exports.mbToBytes=le,exports.megabyte=pe,exports.mergeFileConfig=function(e){var t=ue;if(!e)return t;if(void 0!==e.serverFileSizeLimit&&(t.serverFileSizeLimit=le(e.serverFileSizeLimit)),void 0!==e.avatarSizeLimit&&(t.avatarSizeLimit=le(e.avatarSizeLimit)),!e.endpoints)return t;var n=function(n){var o=e.endpoints[n];t.endpoints[n]||(t.endpoints[n]={});var i=t.endpoints[n];if(!0===o.disabled)return i.disabled=!0,i.fileLimit=0,i.fileSizeLimit=0,i.totalSizeLimit=0,i.supportedMimeTypes=[],"continue";void 0!==o.fileSizeLimit&&(i.fileSizeLimit=le(o.fileSizeLimit)),void 0!==o.totalSizeLimit&&(i.totalSizeLimit=le(o.totalSizeLimit));["fileLimit"].forEach((function(e){void 0!==o[e]&&(i[e]=o[e])})),o.supportedMimeTypes&&(i.supportedMimeTypes=he(o.supportedMimeTypes))};for(var o in e.endpoints)n(o);return t},exports.modularEndpoints=Me,exports.openAISchema=C,exports.openapiToFunction=function(e){for(var t,n,o,i,r=[],s={},p=null!==(o=null===(n=null===(t=e.servers)||void 0===t?void 0:t[0])||void 0===n?void 0:n.url)&&void 0!==o?o:"",l=0,u=Object.entries(e.paths);l<u.length;l++)for(var c=u[l],d=c[0],m=c[1],h=0,f=Object.entries(m);h<f.length;h++){var g=f[h],x=g[0],v=g[1],E=v.operationId||"".concat(x,"_").concat(d),b=v.summary||v.description||"",y={type:"object",properties:{},required:[]};if(v.requestBody){var z=v.requestBody.content,I=vt(null===(i=z[Object.keys(z)[0]])||void 0===i?void 0:i.schema,e.components);y.properties.requestBody=I}if(v.parameters)for(var T=0,S=v.parameters;T<S.length;T++){var M=S[T];I=vt(a({},M.schema),e.components);y.properties[M.name]=I,M.required&&y.required.push(M.name),M.description&&!("$$ref"in y.properties[M.name])&&(y.properties[M.name].description=M.description)}var _=new gt(E,b,y);r.push(_);var O=new xt(p,d,x,E,!!v["x-openai-isConsequential"],v.requestBody?"application/json":"application/x-www-form-urlencoded");s[E]=O}return{functionSignatures:r,requestBuilders:s}},exports.parseCompactConvo=function(e){var t,n=e.endpoint,o=e.endpointType,i=e.conversation,r=e.possibleValues;if(!n)throw new Error("undefined endpoint: ".concat(n));var s=Ve[n];if(!s&&!o)throw new Error("Unknown endpoint: ".concat(n));!s&&o&&(s=Ve[o]);var a=s.parse(i),p=(null!=r?r:{}).models;return p&&a&&(a.model=null!==(t=Ne(p))&&void 0!==t?t:a.model),a},exports.parseConvo=function(e){var t,n,o=e.endpoint,i=e.endpointType,r=e.conversation,s=e.possibleValues,a=De[o];if(!a&&!i)throw new Error("Unknown endpoint: ".concat(o));!a&&i&&(a=De[i]);var p=a.parse(r),l=null!=s?s:{},u=l.models,c=l.secondaryModels;return u&&p&&(p.model=null!==(t=Ne(u))&&void 0!==t?t:p.model),c&&p.agentOptions&&(p.agentOptions.model=null!==(n=Ne(c))&&void 0!==n?n:p.agentOptions.model),p},exports.rateLimitSchema=Ee,exports.removeNullishValues=G,exports.request=ct,exports.resolveRef=vt,exports.retrievalMimeTypes=[/^(text\/(x-c|x-c\+\+|html|x-java|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain))$/,/^(application\/(json|pdf|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation)))$/],exports.retrievalMimeTypesList=["text/x-c","text/x-c++","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain"],exports.setAcceptLanguageHeader=function(e){o.defaults.headers.common["Accept-Language"]=e},exports.setTokenHeader=Ze,exports.sha1=ht,exports.supportedMimeTypes=se,exports.supportsBalanceCheck=_e,exports.supportsFiles=Y,exports.supportsRetrieval=Te,exports.tAgentOptionsSchema=T,exports.tConversationSchema=M,exports.tConvoUpdateSchema=O,exports.tExampleSchema=I,exports.tMessageSchema=S,exports.tPluginAuthConfigSchema=y,exports.tPluginSchema=z,exports.tPresetSchema=_,exports.tPresetUpdateSchema=P,exports.textMimeTypes=oe,exports.validateAndParseOpenAPISpec=function(e){var t;try{var n=void 0;try{n=JSON.parse(e)}catch(t){n=s.load(e)}if(!n.servers||!Array.isArray(n.servers)||0===n.servers.length)return{status:!1,message:"Could not find a valid URL in `servers`"};if(!n.servers[0].url)return{status:!1,message:"Could not find a valid URL in `servers`"};var o=n.paths;if(!o||"object"!=typeof o||0===Object.keys(o).length)return{status:!1,message:"No paths found in the OpenAPI spec."};for(var i=(null===(t=n.components)||void 0===t?void 0:t.schemas)||{},r=[],a=0,p=Object.entries(o);a<p.length;a++)for(var l=p[a],u=l[0],c=l[1],d=0,m=Object.entries(c);d<m.length;d++){var h=m[d],f=h[0],g=h[1],x=g.responses;if("object"==typeof g&&x)for(var v=0,E=Object.entries(x);v<E.length;v++){var b=E[v],y=b[0],z=b[1].content;if(z&&z["application/json"]&&z["application/json"].schema){var I=z["application/json"].schema;if("$ref"in I&&"string"==typeof I.$ref){var T=I.$ref.split("/").pop();T&&!i[T]&&r.push("In context=('paths', '".concat(u,"', '").concat(f,"', '").concat(y,"', 'response', 'content', 'application/json', 'schema'), reference to unknown component ").concat(T,"; using empty schema"))}}}}return{status:!0,message:r.join("\n")||"OpenAPI spec is valid.",spec:n}}catch(e){return{status:!1,message:"Error parsing OpenAPI spec."}}},exports.validateVisionModel=function(e,t){return void 0===t&&(t=[]),!!e&&Oe.concat(t).some((function(t){return e.includes(t)}))},exports.visionModels=Oe;
//# sourceMappingURL=index.js.map
